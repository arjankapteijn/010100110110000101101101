<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pijl naar huis</title>
    <style>
        body { text-align: center; font-family: Arial, sans-serif; }
        #compass-container { position: relative; width: 150px; margin: 50px auto; }
        #arrow {
            width: 100px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform-origin: 50% 100%;
            transition: transform 0.3s ease-out;
        }
    </style>
</head>
<body>
    <h2>Deze pijl wijst naar huis:</h2>
    <div id="compass-container">
        <img id="arrow" src="https://upload.wikimedia.org/wikipedia/commons/3/3d/Simple_arrow.svg">
    </div>
    <p id="status">Locatie ophalen...</p>

    <script>
        const homeCoords = { lat: 52.379189, lon: 4.899431 }; // Vervang met jouw huiscoördinaten
        let currentHeading = 0;  // Kompasrichting van het apparaat (van de device orientation)
        let lastAngles = [];  // Voor smoothing van de hoeken
        
        window.addEventListener("deviceorientation", (event) => {
            if (event.alpha !== null) {
                currentHeading = event.alpha; // alpha is de rotatie van de telefoon zelf
            }
        });
        
        // Berekening van de richting (bearing) naar je huis
        function getBearing(lat1, lon1, lat2, lon2) {
            let dLon = toRadians(lon2 - lon1);
            let y = Math.sin(dLon) * Math.cos(toRadians(lat2));
            let x = Math.cos(toRadians(lat1)) * Math.sin(toRadians(lat2)) - 
                    Math.sin(toRadians(lat1)) * Math.cos(toRadians(lat2)) * Math.cos(dLon);
            return (toDegrees(Math.atan2(y, x)) + 360) % 360;
        }
        
        function updateArrow(bearing) {
            // Het aanpassen van de pijl ten opzichte van zowel de locatie als de apparaatoriëntatie
            const relativeAngle = (bearing - currentHeading + 360) % 360; // Hier compenseren we de draaiing van de telefoon
            const smoothRotation = smoothAngle(relativeAngle); // Smoothing van de hoeken
            document.getElementById('arrow').style.transform = `rotate(${smoothRotation}deg)`;
        }
        
        // Verkrijg de huidige locatie van de gebruiker
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition((position) => {
                    let userLat = position.coords.latitude;
                    let userLon = position.coords.longitude;
                    let bearing = getBearing(userLat, userLon, homeCoords.lat, homeCoords.lon);
                    document.getElementById('status').textContent = `Jouw locatie: ${userLat.toFixed(5)}, ${userLon.toFixed(5)}`;
                    updateArrow(bearing);
                }, (error) => {
                    document.getElementById('status').textContent = "Locatie niet beschikbaar.";
                }, { enableHighAccuracy: true });
            } else {
                document.getElementById('status').textContent = "Geolocation wordt niet ondersteund.";
            }
        }
        
        getLocation();
    </script>
</body>
</html>
